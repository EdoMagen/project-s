function call_api(a){$("#bg_layer").removeClass("kenburns"),jQuery.ajax({url:"/api/api.php",dataType:"json",type:"POST",data:{tag_twitter:a,tag_instagram:a},success:function(a){payload=a,null==payload.instagram&&(payload.instagram=[]),0==payload.instagram.length&&0==payload.twitter.length?no_such_hashtag():(ticker=setInterval(tick,slide_duration),smallScreen||$("#bg_layer").addClass("kenburns"),build_tree())},error:function(){console.log("error reaching api, waiting 5 seconds and retrying"),setTimeout(function(){call_api(a)},5e3)}})}function parseTwitterDate(a){var b=new Date(Date.parse(a)),c=new Date;K.ie;var d=Math.floor((c-b)/1e3);return 1>=d?"just now":20>d?d+" seconds ago":40>d?"half a minute ago":60>d?"less than a minute ago":90>=d?"one minute ago":3540>=d?Math.round(d/60)+" minutes ago":5400>=d?"1 hour ago":86400>=d?Math.round(d/3600)+" hours ago":129600>=d?"1 day ago":604800>d?Math.round(d/86400)+" days ago":777600>=d?"1 week ago":"on "+b}function love_me(){$("#loveme").fadeIn()}function no_such_hashtag(){$("#no_tag").fadeIn()}function build_tree(){function a(){var a,b=document.createElement("div"),c=payload.twitter[tw_counter].user.profile_image_url;c=c.replace("_normal","_bigger"),b.className+="tw_wrapper",void 0!=payload.twitter[tw_counter].entities.media&&null!=payload.twitter[tw_counter].entities.media?(b.className+=" huge",a=' <div class="top">              <div class="tweet_user_img"><img src="'+c+'"></div>'+'              <span class="tweet_user_screen_name">'+payload.twitter[tw_counter].user.name+"</span><br/>"+'              <span class="tweet_user_real_name">@'+payload.twitter[tw_counter].user.screen_name+"</span>"+"            </div>"+'            <div class="tweet_text" style="bottom: 2%;font-size: 0.8em;margin: 0px;left: 0;width: 42%;overflow: hidden;height: 83%;display: inline-block;vertical-align: top;position: absolute;top: 4em;padding: 0.7em;">'+payload.twitter[tw_counter].text+"</div>"+'            <div class="tweet_img" style="background-image: url('+payload.twitter[tw_counter].entities.media[0].media_url+');width: 55%;height: 0;position: relative;padding-bottom: 55%;background-size: contain;background-repeat: no-repeat;background-position: 50% 50%;margin-top: -9%;float: right;margin-bottom: 8%;"></div>'+'            <div class="bottom" style="position: absolute;bottom: 0;right: 30px;">'+'              <div class="tweet_time">'+parseTwitterDate(payload.twitter[tw_counter].created_at)+"</div>"+'              <div class="tweet_retweets entypo-retweet">'+payload.twitter[tw_counter].retweet_count+"</div>"+'              <div class="tweet_favorites entypo-star">'+payload.twitter[tw_counter].favorite_count+"</div>"+'              <br style="clear:both;">'+"            </div>"):a=' <div class="top">              <div class="tweet_user_img"><img src="'+c+'"></div>'+'              <span class="tweet_user_screen_name">'+payload.twitter[tw_counter].user.name+"</span><br/>"+'              <span class="tweet_user_real_name">@'+payload.twitter[tw_counter].user.screen_name+"</span>"+"            </div>"+'            <div class="tweet_text">'+payload.twitter[tw_counter].text+"</div>"+'            <div class="bottom">'+'              <div class="tweet_time">'+parseTwitterDate(payload.twitter[tw_counter].created_at)+"</div>"+'              <div class="tweet_retweets entypo-retweet">'+payload.twitter[tw_counter].retweet_count+"</div>"+'              <div class="tweet_favorites entypo-star">'+payload.twitter[tw_counter].favorite_count+"</div>"+'              <br style="clear:both;">'+"            </div>",b.innerHTML=a,document.getElementById("show").appendChild(b)}function b(){var a;null!=payload.instagram[ig_counter].caption?void 0!=payload.instagram[ig_counter].caption.text&&null!=payload.instagram[ig_counter].caption.text&&(a=payload.instagram[ig_counter].caption.text):a="";var b;void 0!=payload.instagram[ig_counter].videos?b='<video autoplay="autoplay" loop muted>           <source src="'+payload.instagram[ig_counter].videos.standard_resolution.url+'" type="video/mp4">'+"                Your browser does not support the video tag."+"       </video>":(b='<img src="'+payload.instagram[ig_counter].images.standard_resolution.url+'">',ig_arr.push(payload.instagram[ig_counter].images.standard_resolution.url));var c=document.createElement("div");c.className+="ig_wrapper";var d='<div class="left"><div class="ig_user_img"><img src="'+payload.instagram[ig_counter].user.profile_picture+'"></div>'+'<div class="ig_user_screen_name">@'+payload.instagram[ig_counter].user.username+"</div>"+'<div class="ig_caption">'+a+"</div>"+'<div class="ig_likes entypo-heart">Likes: '+payload.instagram[ig_counter].likes.count+"</div>"+"</div>"+'<div class="right">'+'<div class="ig_img">'+b+"</div>"+"</div>";c.innerHTML=d,document.getElementById("show").appendChild(c)}ig_amount=payload.instagram.length,tw_amount=payload.twitter.length,diff=Math.floor(ig_amount/tw_amount),total_slides=ig_amount+tw_amount,duration=1e4*(ig_amount+tw_amount),current_slide_counter=0,next_slide_counter=0,tw_counter=0,ig_counter=0,all_counter=0;for(var c=0;tw_amount>c;c++){a(),tw_counter++,all_counter++;for(var d=0;diff>d;d++)b(),ig_counter++,all_counter++}for(all_counter;total_slides>all_counter;all_counter++)b(),ig_counter++}function tick(){$("#loveme").fadeOut(),$(current_slide).removeClass("active"),current_slide=$("#show").children()[current_slide_counter],next_slide_counter=current_slide_counter+1,next_slide=$("#show").children()[next_slide_counter],current_slide_counter++,$(current_slide).addClass("active"),$(current_slide).hasClass("ig_wrapper")&&(smallScreen||$("#bg_layer").css("background-image","url("+$(".ig_wrapper.active").find("img").attr("src")+")"),$(".header .logo.active").removeClass("active"),$(".header .logo.instagram").addClass("active")),$(current_slide).hasClass("tw_wrapper")&&(smallScreen||$("#bg_layer").css("background-image","url("+$(".tw_wrapper.active").find("img").attr("src")+")"),$(".header .logo.active").removeClass("active"),$(".header .logo.twitter").addClass("active")),next_slide_counter>total_slides&&(clearInterval(ticker),$("#loveme").fadeIn(),document.getElementById("show").innerHTML="",call_api(),start_show(slide_duration,hashtag))}function start_show(a,b){slide_duration=a,document.getElementById("hashtag").innerHTML="#"+b,document.getElementById("loveme_tag").innerHTML="#"+b,$("#header").show(),$("body").css("overflow","hidden"),love_me(),call_api(b)}function gogogo(a){if(validate_tag(a)){try{ga("send","event","Homepage","search",a)}catch(b){}window.location="/show.php?tag="+a}}function validate_tag(a){return"#"=="#"+a?($("#error_message").text("You must enter a hashtag for it to work :)"),$("#error_message").addClass("active"),!1):a.length>25||a.length<3?($("#error_message").text("The hashtag must be 3-25 characters long"),$("#error_message").addClass("active"),!1):a.indexOf(" ")>=0?($("#error_message").text("The hashtag cannot have spaces in it :)"),$("#error_message").addClass("active"),!1):specialchars(a)?($("#error_message").text("The hashtag cannot have special characters in it :)"),$("#error_message").addClass("active"),!1):twitter_compatible.test("#"+a)?(hashtag=a,$("#error_message").removeClass("active"),!0):($("#error_message").text("Invalid hashtag :)"),$("#error_message").addClass("active"),!1)}function specialchars(a){var b=/[!@#$%^&*()+\-=\[\]{};':"\\|,.<>\/?*$]/g;return b.test(a)}function addListener(a,b,c){a.addEventListener?a.addEventListener(b,c):a.attachEvent&&a.attachEvent("on"+b,c)}function toggleFullScreen(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}var slide_duration,payload,ticker,ig_amount,tw_amount,diff,duration,total_slides,current_slide,current_slide_counter,next_slide,next_slide_counter,tw_counter,ig_counter,all_counter,ig_arr=[],smallScreen=window.innerWidth<=1025,K=function(){var a=navigator.userAgent;return{ie:a.match(/MSIE\s([^;]*)/)}}();twitter_compatible=function(){function a(a,b){return b=b||0,a=a.toString(16),fromLen=a.length>4?a.length:4,b=b.toString(16),toLen=b.length>4?b.length:4,"0"!==b?"\\u"+("0000"+a).slice(-fromLen)+"-\\u"+("0000"+b).slice(-toLen):("\\u{"+("0000"+a).slice(-fromLen)+"}",void 0)}return LATIN_ACCENTS=[a(192,214),a(216,246),a(248,255),a(256,591),a(595,596),a(598,599),a(601),a(603),a(611),a(616),a(623),a(626),a(649),a(651),a(699),a(768,879),a(7680,7935)].join(""),NON_LATIN_HASHTAG_CHARS=[a(1024,1279),a(1280,1319),a(11744,11775),a(42560,42655),a(1425,1471),a(1473,1474),a(1476,1477),a(1479),a(1488,1514),a(1520,1524),a(64274,64296),a(64298,64310),a(64312,64316),a(64318),a(64320,64321),a(64323,64324),a(64326,64335),a(1552,1562),a(1568,1631),a(1646,1747),a(1749,1756),a(1758,1768),a(1770,1775),a(1786,1788),a(1791),a(1872,1919),a(2208),a(2210,2220),a(2276,2302),a(64336,64433),a(64467,64829),a(64848,64911),a(64914,64967),a(65008,65019),a(65136,65140),a(65142,65276),a(8204,8204),a(3585,3642),a(3648,3662),a(4352,4607),a(12592,12677),a(43360,43391),a(44032,55215),a(55216,55295),a(65441,65500)].join(""),CJ_HASHTAG_CHARACTERS=[a(12449,12538),a(12540,12542),a(65382,65439),a(65296,65305),a(65313,65338),a(65345,65370),a(12353,12438),a(12441,12446),a(13312,19903),a(19968,40959),a(131072,173791),a(173824,177983),a(177984,178207),a(194560,195103),a(12291),a(12293),a(12347)].join(""),HASHTAG_ALPHA="[a-z_"+LATIN_ACCENTS+NON_LATIN_HASHTAG_CHARS+CJ_HASHTAG_CHARACTERS+"]",HASHTAG_ALPHANUMERIC="[a-z0-9_"+LATIN_ACCENTS+NON_LATIN_HASHTAG_CHARS+CJ_HASHTAG_CHARACTERS+"]",new RegExp("(#|\uff03)("+HASHTAG_ALPHANUMERIC+"*"+HASHTAG_ALPHA+HASHTAG_ALPHANUMERIC+"*)","ig")}(),$(document).ready(function(){$("#hashtag_input").focus(),navigator.userAgent.toLowerCase().indexOf("chrome")>-1||$("#bg_layer").css({"background-size":"auto",opacity:".2"}),$("#hashtag_input").keypress(function(a){13==a.which&&(a.preventDefault(),gogogo($("#hashtag_input").val()))})});